<html>
<head>
    <title>Java基础14---ref包、WeakHashMap的介绍</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shCore.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushCpp.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushJScript.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushSql.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushPython.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushCss.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushJava.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushPowerShell.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushBash.js"></script>
	<script type="text/javascript" src="../../syntaxhighlighter_3.0.83/scripts/shBrushXml.js"></script>

	<link rel="Stylesheet" type="text/css" href="../../stylesheets/stylesheet.css" />
	<link type="text/css" rel="stylesheet" href="../../syntaxhighlighter_3.0.83/styles/shCoreDefault.css" />
	<link type="text/css" rel="Stylesheet" href="../../syntaxhighlighter_3.0.83/styles/shThemeMidnight.css" />
	<script type="text/javascript">SyntaxHighlighter.all();</script>
</head>
<body>
    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/Yanam">View on GitHub</a>

          <h1 id="project_title">胡诌</h1>
          <h2 id="project_tagline"></h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">

<div class="toc">
<ul>
<li><a href="#toc_0.1">java.lang.ref</a>
<ul>
<li><a href="#toc_0.1.1">StrongReference</a>
<ul>
<li><a href="#toc_0.1.1.1">为什么会有内存泄露的情况？</a>
</ul>
<li><a href="#toc_0.1.2">SoftReference</a>
<li><a href="#toc_0.1.3">WeakReference</a>
<li><a href="#toc_0.1.4">PhantomReference</a>
<li><a href="#toc_0.1.5">引用类型特征总结</a>
</ul>
</ul>
</ul>
</div>


<h2 id="toc_0.1">java.lang.ref</h2>
<p>
这个包以前很少用到，因为要看WeakHashMap的缘故不得不学写了一下。
</p>

<p>
<code>java.lang.ref</code> 这个包提供了与垃圾回收不同等级交互的引用对象类。（很拗口是吧？这说明是我自己翻译的）
</p>

<p>
接下来我们按引用由弱到强来介绍这个包下的类。
</p>

<h3 id="toc_0.1.1">StrongReference</h3>
<p>
第一个叫<code>StrongReference(强引用)</code>，它就是我们经常会用到的普通Java引用，强引用有如下特征：
</p>
<ol>
<li>
强引用可以直接访问对象；

<li>
强引用所指向的对象在任何适合都不会被垃圾回收（这句话容易让人误解啊）；

<li>
强引用可能导致内存泄露；
    它可不是ref包下的类，ref下的类相对它来说都是弱引用。
<pre class="brush:java">
StringBuffer buffer = new StringBuffer();
</pre>

</ol>

<h4 id="toc_0.1.1.1">为什么会有内存泄露的情况？</h4>
<p>
举个简单的例子，我们经常使用的<code>HashMap</code>类，我们通常会把一些k/v的数据放到HashMap中，只要我们不手动删除，那么放到HashMap中的数据(当然都是对象啦)会一直存在，也就说说这些对象占用的堆内存空间一直不会释放，如果持续向HashMap中put数据那么总会出现内存溢出的情况的。
</p>

<p>
感觉弱爆了是不是，难道作为Java程序员还要关心内存回收的问题，我们无法承担如此高深的工作啊，不要怕！ref包为你而来，它提供的不同级别的弱引用可以轻松解决该问题。
</p>

<h3 id="toc_0.1.2">SoftReference</h3>
<p>
这才是我们要介绍的ref包下的第一个类：<code>SoftReference(软引用，先这么翻着吧)</code>。SoftReference指向的对象，当没有强引用指向它时，会在内存驻留一段时间，垃圾回收器会根据JVM的内存使用情况（内存紧缺承担），以及SoftReference的get()方法的使用情况来决定是否对其回收，看不明白的，我们后面会有例子。
</p>

<pre class="brush:java">
SoftReference&lt;Bean&gt; bean = new SoftReference&lt;Bean&gt;(new Bean("test",10));
System.out.println(bean.get());			//"name:10"
</pre>

<p>
SoftReference有如下特征：
</p>
<ol>
<li>
软引用使用get()方法去的对象的强引用，从而访问该对象；

<li>
软引用指向的对象会按照JVM内存的使用情况来决定是否回收；

<li>
软引用可以避免Heap不足引发的异常。

</ol>
<h3 id="toc_0.1.3">WeakReference</h3>
<p>
WeakReference 是比SoftReference更弱的引用类型，特性也和SoftReference类似，区别在于弱引用指向的对象只要进行垃圾回收，不论内存使用情况是否紧张，都会对其进行回收。
</p>

<h3 id="toc_0.1.4">PhantomReference</h3>
<p>
PhantomReference是最弱的做引用，无法像SoftReference、WeakReference那样通过get()方法取得目标对象的强引用。
</p>

<h3 id="toc_0.1.5">引用类型特征总结</h3>

<table>
<tr>
<th>
引用类型
</th>
<th>
却的目标对象的方式
</th>
<th>
垃圾回收条件
</th>
<th>
是否可能内存泄露
</th>
</tr>
<tr>
<td>
强引用
</td>
<td>
直接调用
</td>
<td>
不回收
</td>
<td>
存在
</td>
</tr>
<tr>
<td>
SoftReference软引用
</td>
<td>
get()
</td>
<td>
视内存使用情况
</td>
<td>
不存在
</td>
</tr>
<tr>
<td>
WeakReference弱引用
</td>
<td>
get()
</td>
<td>
永远回收
</td>
<td>
不存在
</td>
</tr>
<tr>
<td>
PhantomReference虚引用
</td>
<td>
无法取得
</td>
<td>
不回收
</td>
<td>
存在
</td>
</tr>
</table>


<hr />
<p>
<code>日期</code>：2013-8-23
</p>

<p>
<code>参考资料</code>：<a href="http://www.ibm.com/developerworks/cn/java/j-lo-langref/">深入探讨 java.lang.ref 包</a>、<a href="https://weblogs.java.net/blog/enicholas/archive/2006/05/understanding_w.html">Understanding Weak References</a>、<a href="http://stackoverflow.com/questions/10599710/weakhashmap-example">WeakHashMap example</a>
</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>
</body>
</html>
